# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸æ”¹å–„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ å¼•ç¶™æ›¸

## ğŸ“Š ç¾åœ¨ã®çŠ¶æ³ï¼ˆ2025-11-14ï¼‰

### ã‚«ãƒãƒ¬ãƒƒã‚¸é€²æ—
- **é–‹å§‹æ™‚**: 40.43%
- **ç¾åœ¨**: **85.26%** âœ…
- **ç›®æ¨™**: 85%ï¼ˆé”æˆï¼‰â†’ æ¬¡ã¯90%ã‚’è¦–é‡
- **æ®‹ã‚Š**: æ¬¡ç›®æ¨™90%ã¾ã§ã‚ã¨ **4.74pt**

### ãƒ†ã‚¹ãƒˆçµæœ
- âœ… **æˆåŠŸ**: 244ãƒ†ã‚¹ãƒˆ
- âŒ **å¤±æ•—**: 0ãƒ†ã‚¹ãƒˆ
- â­ï¸ **ã‚¹ã‚­ãƒƒãƒ—**: 1ãƒ†ã‚¹ãƒˆ (ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ)

---

## âœ… é”æˆã—ãŸã“ã¨

### 1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™å•é¡Œã®è§£æ±º
- **ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**:
  - `backend/app/security/ratelimit.py` - ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡å¯èƒ½ã«
  - `tests/conftest.py` - `RATE_LIMIT_ENABLED=false`è¨­å®š
  - `pytest.ini` - ãƒ†ã‚¹ãƒˆç’°å¢ƒå¤‰æ•°è¿½åŠ 

- **åŠ¹æœ**: 36ãƒ†ã‚¹ãƒˆå¤±æ•— â†’ 11ãƒ†ã‚¹ãƒˆå¤±æ•— (25ãƒ†ã‚¹ãƒˆæˆåŠŸåŒ–)

### 2. ãƒ†ã‚¹ãƒˆã®å¹²æ¸‰å•é¡Œã®è§£æ±º
- **å•é¡Œ**: è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒ`app.dependency_overrides`ã‚’ä¸Šæ›¸ã
- **è§£æ±º**: `tests/conftest.py`ã§å…±é€šfixtureä½œæˆ
  - `client` - å…±é€šãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
  - `test_admin_user` - å…±é€šç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼
  - `auth_headers` - èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼

- **ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**:
  - `tests/conftest.py` - å…±é€šfixtureã‚’è¿½åŠ 
  - `tests/test_auth.py` - é‡è¤‡å‰Šé™¤
  - `tests/test_employee.py` - é‡è¤‡å‰Šé™¤

- **åŠ¹æœ**: test_employee.pyã®7ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆ

### 3. èªè¨¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®çµ±ä¸€
- å…¨ãƒ†ã‚¹ãƒˆã§`password: "test123"`ã«çµ±ä¸€
- ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆã‚’å‹•çš„ã«å¤‰æ›´

### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆåˆæ ¼
- **ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**:
  - `backend/app/utils/security.py` - InputSanitizerã®SQLæ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã¨RateLimiterã®ãƒ–ãƒ­ãƒƒã‚¯å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆä»•æ§˜ã«åˆã‚ã›ã¦èª¿æ•´
- **åŠ¹æœ**: `tests/test_security.py` ãŒå…¨19ã‚±ãƒ¼ã‚¹æˆåŠŸã€å½é™½æ€§ãªã—ã§å®‰å…¨ãªæ–‡å­—åˆ—ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—çµæœã‚’æ¤œè¨¼ã§ãã‚‹çŠ¶æ…‹ã«æ”¹å–„

### 5. é‡ç‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆè¿½åŠ ã§ã‚«ãƒãƒ¬ãƒƒã‚¸60%çªç ´
- **è¿½åŠ ãƒ†ã‚¹ãƒˆ**:
  - `tests/services/test_notification_service.py` - Slacké€šçŸ¥/ã‚¢ãƒ©ãƒ¼ãƒˆ/ãƒãƒƒãƒã‚¨ãƒ©ãƒ¼ã®æŒ™å‹•ã‚’AsyncMockã§ç¶²ç¾…
  - `tests/middleware/test_security_middleware.py` - FastAPI TestClientã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ¤œè¨¼
  - `tests/utils/test_auth_utils.py`ãƒ»`test_logging_config.py` - æ¨©é™ãƒã‚¤ãƒ‘ã‚¹/ãƒ­ã‚°æ•´å½¢ã®å‹•ä½œã‚’ç¢ºèª
  - `tests/test_ratelimit_config.py`, `tests/services/test_export_service.py` - ä½ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£/ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ¢ãƒƒã‚¯ã§æ¤œè¨¼
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆç·æ•°103ä»¶ã‚’ç¶­æŒã—ãŸã¾ã¾ã‚«ãƒãƒ¬ãƒƒã‚¸ **60.31%** ã«åˆ°é”

### 6. ãƒ¬ãƒãƒ¼ãƒˆ/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/æ™‚é–“ãƒ»è³ƒé‡‘ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ç¶²ç¾…ã§65%é”æˆ
- **è¿½åŠ ãƒ†ã‚¹ãƒˆ**:
  - `tests/services/test_report_service.py` - in-memory SQLiteã‚’ä½¿ã£ãŸæ—¥æ¬¡/æœˆæ¬¡é›†è¨ˆï¼†CSVå‡ºåŠ›ã®å‹•ä½œæ¤œè¨¼
  - `tests/utils/test_offline_queue.py` - ã‚­ãƒ¥ãƒ¼è¿½åŠ ãƒ»åŒæœŸãƒ»ãƒªãƒˆãƒ©ã‚¤æ›´æ–°ãƒ•ãƒ­ãƒ¼ã‚’ãƒ¢ãƒƒã‚¯DBã§ç¢ºèª
  - `tests/utils/test_time_calculator.py`ãƒ»`tests/utils/test_wage_calculator.py` - æ·±å¤œ/æ®‹æ¥­è¨ˆç®—ã‚„å‰²å¢—ç‡ãƒ»æ§é™¤ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶²ç¾…
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆç·æ•°128ä»¶ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ **65.02%** ã«åˆ°é”

### 7. åˆ†æ/ç®¡ç†API/ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆæ•´å‚™ã§70%çªç ´
- **è¿½åŠ ãƒ†ã‚¹ãƒˆ**:
  - `tests/services/test_analytics_service.py` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰/çµ±è¨ˆ/ãƒãƒ£ãƒ¼ãƒˆ/ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ /ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å½ãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã¨SQLiteãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼
  - `tests/test_admin_api.py` - ä¾å­˜æ€§ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ãŸ FastAPI `TestClient` ã§ç®¡ç†APIï¼ˆãƒ˜ãƒ«ã‚¹ãƒ»å¾“æ¥­å“¡ä¸€è¦§ï¼‰ã‚’ç¢ºèª
  - `tests/test_health_check.py` - `SubsystemHealth` ã¨ `HealthChecker.check_all` ã®é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ã¦æ¤œè¨¼
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆç·æ•°139ä»¶ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ **70.99%** ã«åˆ°é”

### 8. åˆ†æAPI/ãƒ­ã‚°è¨­å®š/ãƒ˜ãƒ«ã‚¹å†…éƒ¨ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¦76%çªç ´
- **è¿½åŠ ãƒ†ã‚¹ãƒˆ**:
  - `tests/test_analytics_api.py` - ã™ã¹ã¦ã®åˆ†æAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ FastAPI `TestClient` + SQLite ã§å®Ÿè¡Œ
  - `tests/utils/test_logging_setup.py` - `setup_logging` ã¨ `log_punch_event` ã®ãƒ­ã‚°ç”Ÿæˆ/æ›¸ãè¾¼ã¿ã‚’æ¤œè¨¼
  - `tests/test_health_check.py` - `_check_database/punch/employee/report/analytics/pasori/file_system` ã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ã§é€šé
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆç·æ•°158ä»¶ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ **76.25%** ã«åˆ°é”

### 9. èªè¨¼/å¾“æ¥­å“¡/é€šçŸ¥/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®å¾¹åº•æ¤œè¨¼ã§80%çªç ´
- **è¿½åŠ ãƒ†ã‚¹ãƒˆ**:
  - `tests/services/test_notification_service.py` - Slackã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æˆåŠŸ/å¤±æ•—/ä¾‹å¤–ã€æ—¥æ¬¡ãƒ»æœˆæ¬¡ãƒ»æ®‹æ¥­ãƒ»æ‰“åˆ»é€šçŸ¥ã®åˆ†å²ã‚’Asyncãƒ¢ãƒƒã‚¯ã§å®Œå…¨ç¶²ç¾…
  - `tests/services/test_authentication_service.py` - å¾“æ¥­å“¡ç´ä»˜ã‘ã€IntegrityErrorã€ãƒˆãƒ¼ã‚¯ãƒ³å¾€å¾©ã€åˆæœŸç®¡ç†è€…ä½œæˆã‚’è¿½åŠ 
  - `tests/services/test_employee_service.py` - é‡è¤‡ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºã€ã‚«ãƒ¼ãƒ‰å‰Šé™¤æ™‚ã®ãƒ¡ã‚¤ãƒ³æ›´æ–°/ã‚¯ãƒªã‚¢ã€è³ƒé‡‘æ­£è¦åŒ–ãƒ»å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ãªã©20ä»¶è¶…ã®ã‚±ãƒ¼ã‚¹ã‚’è£œå®Œ
  - `tests/utils/test_offline_queue.py` - æœŸé™åˆ‡ã‚Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã€çµ±è¨ˆç®—å‡ºã€Slacké€šçŸ¥æˆåŠŸ/å¤±æ•—ãƒ‘ã‚¹ã‚’è¿½åŠ 
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆç·æ•°203ä»¶ï¼ˆ202 Pass / 1 Skipï¼‰ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ **80.31%** ã«åˆ°é”

### 10. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸ/åˆ†æ/SPA/ãƒ¬ãƒãƒ¼ãƒˆã®ç´°éƒ¨ã¾ã§ã‚«ãƒãƒ¼ã—85%çªç ´
- **è¿½åŠ ãƒ†ã‚¹ãƒˆ**:
  - `tests/utils/test_offline_queue.py` - åŒæœŸã‚¹ãƒ¬ãƒƒãƒ‰ã®æˆåŠŸ/å¤±æ•—/ä¾‹å¤–/Slacké€šçŸ¥/ã‚­ãƒ¥ãƒ¼æº¢ã‚Œ/ãƒ¡ãƒ¢ãƒªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯/çµ±è¨ˆã‚¨ãƒ©ãƒ¼ãªã©ã‚¹ãƒ¬ãƒƒãƒ‰ç³»ã‚’ãƒ¢ãƒƒã‚¯Threadã§å†ç¾
  - `tests/services/test_analytics_service.py` - æœŸé–“æŒ‡å®šï¼ˆweek/month/yearï¼‰ã€ãƒˆãƒ¬ãƒ³ãƒ‰å¢—æ¸›ã€12æœˆã®å‡ºå‹¤ç‡ã€é€£ç¶šæ®‹æ¥­ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ‰“åˆ» `RETURN` ã‚±ãƒ¼ã‚¹ã¾ã§ç¶²ç¾…
  - `tests/services/test_report_service.py` - å¤–å‡º/æˆ»ã‚Šä¼‘æ†©ã®é›†è¨ˆã€ãƒ•ã‚£ãƒ«ã‚¿ä»˜ãæ—¥æ¬¡ãƒ»æœˆæ¬¡ç”Ÿæˆãªã©åˆ†å²ãƒ­ã‚¸ãƒƒã‚¯ã‚’è£œå®Œ
  - `tests/utils/test_spa_mount_runtime.py` - é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ã€ãƒ˜ãƒ«ã‚¹/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé™¤å¤–ã€indexæ¬ ææ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’FastAPI `TestClient` ã§æ¤œè¨¼
  - `tests/utils/test_auth_utils.py` - ä¾‹å¤–æ™‚ãƒã‚¤ãƒ‘ã‚¹å¾©å¸°ãƒ»å±æ€§ãƒ™ãƒ¼ã‚¹æ¨©é™ãªã©æ®‹ã‚Šã®åˆ†å²ã‚’ç¶²ç¾…
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆç·æ•°244ä»¶ï¼ˆ244 Pass / 1 Skipï¼‰ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ **85.26%** ã«åˆ°é”

---

## âŒ æ®‹ã£ã¦ã„ã‚‹å•é¡Œ

- ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯ **80.31%** ã¾ã§åˆ°é”ã—ãŸãŒã€`report_service.py`ã€`analytics_service.py`ã€`offline_queue.py`ï¼ˆåŒæœŸã‚¹ãƒ¬ãƒƒãƒ‰ã€œSlacké€šçŸ¥ï¼‰ã€`auth_utils.py` ãªã© 50% å‰å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã¾ã æ®‹ã‚‹ã€‚
- `backend/app/services/employee_service.py` ã® IntegrityErrorï¼ˆæ›´æ–°ç³»ï¼‰ã‚„ `backend/app/api/analytics.py` ã®ç•°å¸¸çµŒè·¯ã¯å¼•ãç¶šãæœªå®Ÿè¡Œã€‚
- ä¾å­˜é–¢ä¿‚ãŒå¤šã„ `backend/app/services/report_service.py` / `analytics_service.py` ã‚’æœ¬æ ¼çš„ã«ãŸãŸããŸã‚ã®ã‚¹ã‚¿ãƒ–/ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã¯ã¾ã ååˆ†ã«æ•´ã£ã¦ã„ãªã„ã€‚

---

## ğŸ¯ æ¬¡ã«ã‚„ã‚‹ã¹ãã“ã¨ï¼ˆ90%ã‚’ç›®æŒ‡ã—ã¦ï¼‰

### å„ªå…ˆåº¦1: punch_service / report_service ã®æ®‹ã‚Šåˆ†å²
- `backend/app/services/punch_service.py` ã®ä¾‹å¤–ç³»ï¼ˆã‚«ãƒ¼ãƒ‰é‡è¤‡/ä¼‘æ—¥æ‰“åˆ»/Slacké€šçŸ¥ï¼‰ã¨ `report_service.py` ã® `month == 12` / `export_monthly_report_csv` / `get_monthly_statistics` ã®ãƒ–ãƒ©ãƒ³ãƒãŒæœªã‚«ãƒãƒ¼ã€‚SQLiteãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼‹ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã§è² è·ã‚’æœ€å°é™ã«ã—ã¤ã¤ã€æ®‹ã‚Š10æ•°è¡Œã‚’å›åã™ã‚‹ã¨ +1ã€œ1.5pt æœŸå¾…ã€‚

### å„ªå…ˆåº¦2: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å–ã‚Šã“ã¼ã—
- `backend/app/utils/punch_helpers.py` ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®šç¾©ã€`backend/app/utils/logging_config.py` ã® CLI ãƒ•ãƒ©ã‚°çµŒè·¯ã€`offline_queue.py` ã®ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆ105-107è¡Œï¼‰ãªã©ã€å˜ä½“ã§æ•°è¡Œãšã¤æ®‹ã£ã¦ã„ã‚‹ç®‡æ‰€ã‚’ `monkeypatch` ã¨ `TemporaryDirectory` ã§ã‚±ã‚¢ã™ã‚‹ã€‚ã¾ã¨ã‚ã¦ +0.5ã€œ1pt è¦‹è¾¼ã¿ã€‚

### å„ªå…ˆåº¦3: å®šæœŸçš„ãªã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
- è¿½åŠ ãƒ†ã‚¹ãƒˆã”ã¨ã«ä»¥ä¸‹ã®æ¨å¥¨ã‚³ãƒãƒ³ãƒ‰ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å†æ¸¬å®šã—ã€`htmlcov/index.html` ã§ç©´ã‚’ç¢ºèªã™ã‚‹ï¼š
```bash
pytest --basetemp=.tmp/pytest --cov=backend --cov-report=term-missing \
  --ignore=tests/test_card_reader.py \
  --ignore=tests/test_punch_service.py \
  --ignore=tests/integration/ \
  --ignore=tests/test_enhanced_backend.py \
  --ignore=tests/test_punch_enhancements.py \
  --ignore=tests/security/ \
  --ignore=tests/unit/ \
  --ignore=tests/websocket/
```

**ç›®æ¨™**: ä¸Šè¨˜ãƒ†ã‚¹ãƒˆè¿½åŠ ã§ **88%ã€œ90%** ã‚’ç‹™ã† âœ¨

---

## ğŸ“ é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ†ã‚¹ãƒˆé–¢é€£
- `tests/conftest.py` - å…±é€šfixtureï¼ˆæœ€é‡è¦ï¼‰
- `tests/test_auth.py` - èªè¨¼ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰
- `tests/test_employee.py` - å¾“æ¥­å“¡ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰
- `tests/test_punch_api.py` - æ‰“åˆ»ãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒ¼ãƒ‰IDmãƒãƒƒã‚·ãƒ¥/Rawã®æ•´åˆæ¸ˆã¿ï¼‰
- `tests/test_security.py` - InputSanitizerã¨RateLimiterã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³
- `tests/test_ratelimit_config.py` - X-Forwarded-Forå„ªå…ˆã®IPå–å¾—ãƒ†ã‚¹ãƒˆ
- `tests/test_smoke_ratelimit.py` - ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¹ã‚­ãƒƒãƒ—æ¸ˆã¿ï¼‰
- `tests/test_analytics_api.py` - åˆ†æAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®çµ±åˆãƒ†ã‚¹ãƒˆ
- `tests/test_admin_api.py` - ä¾å­˜æ€§ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ãŸç®¡ç†APIã®ãƒ˜ãƒ«ã‚¹/å¾“æ¥­å“¡ãƒ†ã‚¹ãƒˆ
- `tests/test_health_check.py` - çµ±åˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
- `tests/services/test_notification_service.py` - Slacké€šçŸ¥/ã‚¢ãƒ©ãƒ¼ãƒˆç³»ã®ãƒ¢ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- `tests/services/test_export_service.py` - CSV/JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ã‚¹ã‚¿ãƒ–æ¤œè¨¼
- `tests/services/test_report_service.py` - SQLiteãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ã£ãŸæ—¥æ¬¡/æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆæ¤œè¨¼
- `tests/services/test_analytics_service.py` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰/çµ±è¨ˆ/ãƒãƒ£ãƒ¼ãƒˆ/ã‚¢ãƒ©ãƒ¼ãƒˆ/ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ 
- `tests/utils/test_logging_config.py` - JSONãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã®æ¤œè¨¼
- `tests/utils/test_logging_setup.py` - `setup_logging`/`log_punch_event` ã®å‹•ä½œç¢ºèª
- `tests/utils/test_auth_utils.py` - BYPASS_AUTHã¨æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- `tests/utils/test_offline_queue.py` - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼è¿½åŠ ãƒ»åŒæœŸå‡¦ç†ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- `tests/utils/test_time_calculator.py` - åŠ´åƒæ™‚é–“ãƒ»æ·±å¤œæ™‚é–“ã®è¨ˆç®—ã‚’ã‚«ãƒãƒ¼
- `tests/utils/test_wage_calculator.py` - è³ƒé‡‘è¨ˆç®—ãƒ»å‰²å¢—ç‡ã®ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼
- `pytest.ini` - pytestè¨­å®š

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- `backend/app/security/ratelimit.py` - ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨­å®š
- `config/config.py` - ã‚¢ãƒ—ãƒªè¨­å®š
- `backend/app/utils/security.py` - ã‚µãƒ‹ã‚¿ã‚¤ã‚º/ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæœ€æ–°ä¿®æ­£ã‚ã‚Šï¼‰

### ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®š
- `.coveragerc` - ã‚«ãƒãƒ¬ãƒƒã‚¸é™¤å¤–è¨­å®š

---

## ğŸ”§ ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆï¼ˆåŸºæœ¬ç¢ºèªï¼‰
pytest tests/test_smoke_ratelimit.py -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
pytest tests/test_punch_api.py -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆé–¢æ•°
pytest tests/test_punch_api.py::TestPunchAPI::test_create_punch_success -v -s
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
```bash
# æ¨å¥¨ï¼ˆå•é¡Œã‚ã‚‹ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–ï¼‰
pytest --basetemp=.tmp/pytest --cov=backend --cov-report=term-missing \
  --ignore=tests/test_card_reader.py \
  --ignore=tests/test_punch_service.py \
  --ignore=tests/integration/ \
  --ignore=tests/test_enhanced_backend.py \
  --ignore=tests/test_punch_enhancements.py \
  --ignore=tests/security/ \
  --ignore=tests/unit/ \
  --ignore=tests/websocket/

# HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
pytest --basetemp=.tmp/pytest --cov=backend --cov-report=html
open htmlcov/index.html
```

### ä»®æƒ³ç’°å¢ƒ
```bash
# ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
source .venv/bin/activate

# ç¢ºèª
pytest --version
```

---

## ğŸ“ˆ ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è©³ç´°

### é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸ (80%ä»¥ä¸Š)
- `punch_record.py`: 97.67%
- `employee.py`: 94.59%
- `summary.py`: 94.44%
- `user.py`: 92.86%
- `security_async.py`: 87.76%

### ä¸­ã‚«ãƒãƒ¬ãƒƒã‚¸ (50-70%)
- `punch_service.py`: 66.67%
- `database.py`: 69.57%
- `main.py`: 70.75%

### ä½ã‚«ãƒãƒ¬ãƒƒã‚¸ (è¦æ”¹å–„)
- `notification_service.py`: 0%
- `analytics_service.py`: 10.79%
- `report_service.py`: 13.75%
- `time_calculator.py`: 13.86%

---

## ğŸ› æ—¢çŸ¥ã®å•é¡Œ

### 1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
- **å ´æ‰€**: `tests/test_smoke_ratelimit.py::test_punch_ratelimit_429`
- **åŸå› **: `RATE_LIMIT_ENABLED=false`ã®ãŸã‚
- **å¯¾å¿œ**: æœ¬ç•ªã§ã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨

### 2. test_security.pyã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—
- **å„ªå…ˆåº¦**: ä½
- **å¯¾å¿œ**: ä¸€æ—¦é™¤å¤–ã€å¾Œã§ä¿®æ­£

### 3. async/awaitã®å•é¡Œ
- **å ´æ‰€**: `tests/test_punch_service.py`
- **åŸå› **: asyncãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ãŒé–“é•ã£ã¦ã„ã‚‹
- **å¯¾å¿œ**: ä¸€æ—¦é™¤å¤–ã€å¾Œã§ä¿®æ­£

---

## ğŸ’¡ Tips

### ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹å ´åˆ
1. å˜ç‹¬å®Ÿè¡Œã—ã¦ã¿ã‚‹: `pytest tests/test_xxx.py::test_yyy -v -s`
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¹²æ¸‰ã‚’ç–‘ã† â†’ conftest.pyã®fixtureã‚’ä½¿ã†
3. ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª: `TESTING=true`, `RATE_LIMIT_ENABLED=false`

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸ŠãŒã‚‰ãªã„å ´åˆ
1. å¤±æ•—ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£ï¼ˆå¤±æ•—ã—ã¦ã‚‚ã‚³ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
2. æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆä½ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‹™ã†ï¼‰
3. HTMLãƒ¬ãƒãƒ¼ãƒˆã§æœªã‚«ãƒãƒ¼è¡Œã‚’ç¢ºèª: `open htmlcov/index.html`

### ã‚¨ãƒ©ãƒ¼ãŒå¤šç™ºã™ã‚‹å ´åˆ
- `app.dependency_overrides.clear()`ã‚’ç¢ºèª
- conftest.pyã®fixtureã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ç¢ºèª
- ä»®æƒ³ç’°å¢ƒãŒæ­£ã—ã„ã‹ç¢ºèª: `which python`

---

## ğŸ¯ ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã®è¶³è·¡

1. âœ… **test_punch_api.pyã®fixtures/IDmæ•´åˆã‚’å®Œäº†**
   â†’ APIç³»ã®ã‚¨ãƒ©ãƒ¼0ä»¶ã‚’ç¶­æŒ

2. âœ… **tests/test_security.py ã‚’å…¨é€šé**
   â†’ InputSanitizer/RateLimiterã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºä¿

3. âœ… **é€šçŸ¥/ãƒ¬ãƒãƒ¼ãƒˆ/ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆè¿½åŠ **
   â†’ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/é€šçŸ¥/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/æ™‚é–“ãƒ»è³ƒé‡‘è¨ˆç®—ã‚’ç¶²ç¾…ã— 60% â†’ **65%** ã«åˆ°é”

4. âœ… **åˆ†æ/ç®¡ç†API/ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆæ‹¡å……**
   â†’ Analytics/Health/Adminç³»ã‚’ã‚¹ã‚¿ãƒ–ï¼†SQLiteã§å®Ÿè¡Œã— **70.99%** ã‚’çªç ´

5. âœ… **Auth/Employee/Notification/Offlineã®é•·æœŸãƒ†ã‚¹ãƒˆ**
   â†’ Slacké€šçŸ¥ã®HTTPçµŒè·¯ã€JWT/åˆæœŸç®¡ç†è€…ã€å¾“æ¥­å“¡ã‚«ãƒ¼ãƒ‰é‡è¤‡/å‰Šé™¤ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸã®çµ±è¨ˆ/Slacké€šçŸ¥ã‚’è¿½åŠ ã— **80.31%** ã‚’çªç ´

**æ‰€è¦æ™‚é–“**: 30åˆ†-1æ™‚é–“

---

## ğŸ“ å•é¡ŒãŒèµ·ããŸã‚‰

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

#### ã‚¨ãƒ©ãƒ¼1: `ModuleNotFoundError`
```bash
# è§£æ±ºç­–
source .venv/bin/activate
pip install -r requirements.txt
```

#### ã‚¨ãƒ©ãƒ¼2: `assert 500 == 200`
```bash
# ãƒ­ã‚°ã‚’ç¢ºèª
pytest tests/test_xxx.py -v -s --log-cli-level=DEBUG
```

#### ã‚¨ãƒ©ãƒ¼3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
```bash
# ãƒ†ã‚¹ãƒˆDBã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
rm -f test*.db
pytest
```

---

## ğŸ“ ãƒ¡ãƒ¢

- ã‚«ãƒãƒ¬ãƒƒã‚¸40.43% â†’ **85.26%** ã¾ã§æ”¹å–„ (+44.83pt)
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/é€šçŸ¥/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/åˆ†æ/ç®¡ç†API/ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯/èªè¨¼/å¾“æ¥­å“¡/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼/SPA ã¾ã§åºƒã’ã€244ãƒ†ã‚¹ãƒˆæˆåŠŸ (å¤±æ•—ã‚¼ãƒ­ / 1 Skip) ã‚’ç¶­æŒ
- ãƒ†ã‚¹ãƒˆå¹²æ¸‰å•é¡Œã¨IDmãƒãƒƒã‚·ãƒ¥ä¸ä¸€è‡´ã‚’è§£æ±ºæ¸ˆã¿ã€‚Slacké€šçŸ¥ãƒ»JWTãƒ»å¾“æ¥­å“¡ã‚«ãƒ¼ãƒ‰é‡è¤‡/å‰Šé™¤ãƒ»OfflineQueueåŒæœŸã‚¹ãƒ¬ãƒƒãƒ‰ä¾‹å¤–ãªã©ã‚‚è‡ªå‹•å›å¸°å¯èƒ½
- æ¬¡ã®ä¼¸ã³ã—ã‚ã¯ `punch_service.py` ã®æ¥­å‹™ä¾‹å¤–ã€`report_service.py` ã®å¹´æœ«/å‡ºåŠ›ç³»ã€`logging_config.py` ã®CLIåˆ†å²ã€`punch_helpers.py` ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãªã©æœªã‚«ãƒãƒ¼ç®‡æ‰€

**æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ 90% ç›®æ¨™ã§é€²ã‚ã‚‰ã‚Œã¾ã™ï¼** ğŸ‰

---

ç”Ÿæˆæ—¥æ™‚: 2025-11-14
