# å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.0 ğŸš€

[![Tests](https://github.com/tsuyoshi-sk/attendance_system/actions/workflows/test.yml/badge.svg)](https://github.com/tsuyoshi-sk/attendance_system/actions)
[![Code Quality](https://github.com/tsuyoshi-sk/attendance_system/actions/workflows/quality.yml/badge.svg)](https://github.com/tsuyoshi-sk/attendance_system/actions)
[![Deploy](https://github.com/tsuyoshi-sk/attendance_system/actions/workflows/deploy.yml/badge.svg)](https://github.com/tsuyoshi-sk/attendance_system/actions)
[![codecov](https://codecov.io/gh/tsuyoshi-sk/attendance_system/branch/main/graph/badge.svg)](https://codecov.io/gh/tsuyoshi-sk/attendance_system)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

**ä¸–ç•Œæœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç´šiPhone Suicaå¯¾å¿œå‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **

PaSoRi RC-S380ã€iPhone Suicaã€Android NFCå¯¾å¿œã®æ¬¡ä¸–ä»£å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

## ğŸš€ ä»Šã™ãå§‹ã‚ã‚‹

**5åˆ†ã§å‹•ã‹ã—ãŸã„** â†’ [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](QUICKSTART.md)  
**è©³ã—ãçŸ¥ã‚ŠãŸã„** â†’ ã“ã®READMEã‚’èª­ã¿é€²ã‚ã‚‹

## âš¡ æ¦‚è¦

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯4ä¸¦è¡ŒAIé–‹ç™ºã«ã‚ˆã‚Š1ãƒ¶æœˆã§æ§‹ç¯‰ã•ã‚ŒãŸã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»ãªç‰¹å¾´
- ğŸ“± **iPhone Suicaå¯¾å¿œ** - ä¸–ç•Œåˆã®å®Ÿè£…
- ğŸ” **OWASP ASVS Level 2** - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- ğŸ“Š **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ** - WebSocket + PWA
- ğŸ—ï¸ **Clean Architecture** - ä¿å®ˆæ€§é‡è¦–ã®è¨­è¨ˆ

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### ğŸ”¥ åŸºæœ¬æ©Ÿèƒ½
- ğŸšª **å¤šæ§˜ãªæ‰“åˆ»æ–¹å¼**: PaSoRi RC-S380ãƒ»iPhone Suicaãƒ»Android NFCãƒ»QRã‚³ãƒ¼ãƒ‰å¯¾å¿œ
- ğŸ‘¥ **ç„¡åˆ¶é™å¾“æ¥­å“¡ç®¡ç†**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œ
- ğŸ¢ **éƒ¨ç½²ãƒ»ãƒãƒ¼ãƒ ç®¡ç†**: éšå±¤çš„çµ„ç¹”ç®¡ç†
- ğŸ” **æœ¬æ ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: JWTãƒ»RBACï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰
- ğŸ“Š **é«˜åº¦åˆ†ææ©Ÿèƒ½**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æãƒ»äºˆæ¸¬æ©Ÿèƒ½
- ğŸŒ **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåŸºç›¤**: è¤‡æ•°çµ„ç¹”å¯¾å¿œæº–å‚™æ¸ˆã¿

### âš¡ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½
- ğŸ—ï¸ **Clean Architecture**: ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ
- ğŸ“ˆ **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: æ•°åƒåè¦æ¨¡å¯¾å¿œ
- ğŸ”’ **æœ€é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: OWASP ASVS Level 2æº–æ‹ 
- ğŸš€ **è‡ªå‹•CI/CD**: GitHub Actionså®Œå‚™
- ğŸ“± **PWAå¯¾å¿œ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œå¯èƒ½
- ğŸ” **åŒ…æ‹¬çš„ç›£è¦–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–

## ğŸ› ï¸ å‹•ä½œç’°å¢ƒ

### å¿…é ˆè¦ä»¶
- **Python**: 3.9ä»¥ä¸Šï¼ˆ3.11æ¨å¥¨ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLiteï¼ˆé–‹ç™ºï¼‰ãƒ»PostgreSQLï¼ˆæœ¬ç•ªï¼‰
- **OS**: Windows 10/11, macOS 11+, Ubuntu 20.04+

### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- **æ¨å¥ **: Sony RC-S380ï¼ˆmacOS/Windows/Linuxå¯¾å¿œï¼‰
- **æ—§å‹**: Sony RC-S300ï¼ˆWindowsã®ã¿æ¨å¥¨ï¼‰
- **ç’°å¢ƒå¤‰æ•°**: `PASORI_DEVICE_ID`ã§æŒ‡å®šå¯èƒ½

## ğŸš§ macOS ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆRC-S380ä½¿ç”¨æ™‚ï¼‰

### 1. libusbæ¨©é™è¨­å®š
```bash
# Homebrewã§libusb ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install libusb

# Python nfcpyã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install nfcpy==1.0.4
```

### 2. macOS 14.6+ SIPå›é¿ï¼ˆå¿…è¦ãªå ´åˆï¼‰
```bash
# ä¸€æ™‚çš„ã«SIPã‚’ç„¡åŠ¹åŒ–ï¼ˆå†èµ·å‹•ãŒå¿…è¦ï¼‰
csrutil disable

# RC-S380æ¥ç¶šãƒ†ã‚¹ãƒˆ
python -m nfc

# SIPã‚’å†åº¦æœ‰åŠ¹åŒ–
csrutil enable
```

### 3. ãƒ‡ãƒã‚¤ã‚¹æ¥ç¶šç¢ºèª
```bash
# ç’°å¢ƒå¤‰æ•°ã§ãƒ‡ãƒã‚¤ã‚¹æŒ‡å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
export PASORI_DEVICE_ID="usb:054c:06c1"  # RC-S380
# export PASORI_DEVICE_ID="usb:054c:0dc9"  # RC-S300

# æ¥ç¶šãƒ†ã‚¹ãƒˆ
python hardware/pasori_test.py
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
- **JWTèªè¨¼**: 64æ–‡å­—ä»¥ä¸Šã®å¼·åŠ›ãªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: ã‚«ãƒ¼ãƒ‰IDmã®SHA-256ãƒãƒƒã‚·ãƒ¥åŒ–
- **SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**: SQLAlchemy ORMä½¿ç”¨
- **XSS/CSRFå¯¾ç­–**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼å®Œå‚™
- **ç›£æŸ»ãƒ­ã‚°**: å…¨æ“ä½œã®è¿½è·¡å¯èƒ½
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–

### CI/CDã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **è‡ªå‹•è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³**: Banditãƒ»Safety
- **ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯**: Poetry/pip-audit
- **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¤œå‡º**: git-secretsçµ±åˆ
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: Blackãƒ»Flake8ãƒ»mypy

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- **æ‰“åˆ»API**: 10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†ï¼ˆX-Forwarded-Forå¯¾å¿œï¼‰
- **é™¤å¤–ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: /health, /metrics, /api/v1/admin/*
- **å¤‰æ›´æ–¹æ³•**: `backend/app/api/punch.py` ã® `@limiter.limit("10/minute")` ã‚’ç·¨é›†
- **æœ¬ç•ªæ¨å¥¨**: 10/minuteï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¿…è¦ã«å¿œã˜ã¦ç·©å’Œå¯èƒ½ï¼‰

### æœ¬ç•ªå¿…é ˆç’°å¢ƒå¤‰æ•°
`ENVIRONMENT=production` ã§èµ·å‹•ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å®‰å…¨ãªä¹±æ•°ã§å¿…ãšè¨­å®šã—ã¦ãã ã•ã„ã€‚æœªè¨­å®š/ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å ´åˆã¯ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¾ã›ã‚“ã€‚
- `JWT_SECRET_KEY` â€” 32æ–‡å­—ä»¥ä¸Šã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆæ¨å¥¨64æ–‡å­—ï¼‰
- `IDM_HASH_SECRET` â€” 16æ–‡å­—ä»¥ä¸Šã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
é–‹ç™ºãƒ»æ¤œè¨¼æ™‚ã¯æœªè¨­å®šã§ã‚‚è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ãŒã€æœ¬ç•ªé…ç½®ã§ã¯ `.env` ã‚„Secret Managerã§ç¢ºå®Ÿã«æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
attendance_system/
â”œâ”€â”€ backend/          # FastAPIãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ app/         # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ domain/      # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ services/    # ã‚µãƒ¼ãƒ“ã‚¹å±¤
â”œâ”€â”€ pwa/             # Progressive Web App
â”œâ”€â”€ hardware/        # ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡
â”‚   â””â”€â”€ card_reader.py  # RC-S380/RC-S300å¯¾å¿œ
â”œâ”€â”€ config/          # è¨­å®šç®¡ç†
â””â”€â”€ tests/           # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
```

## ğŸ§ª é–‹ç™ºè€…å‘ã‘æƒ…å ±

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
pytest --basetemp=.tmp/pytest --cov=backend --cov-report=term-missing

# ã‚µãƒ¼ãƒ“ã‚¹å±¤ã¨ã‚³ã‚¢ãƒ†ã‚¹ãƒˆã®ã¿
pytest tests/services/ tests/test_transitions.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆï¼ˆHTMLå½¢å¼ï¼‰
pytest --basetemp=.tmp/pytest --cov=backend --cov-report=html

# ã‚«ãƒãƒ¬ãƒƒã‚¸80%æœªæº€ã§fail
pytest --basetemp=.tmp/pytest --cov=backend --cov-fail-under=80
```

**TMPDIR / --basetemp ã®æ³¨æ„**:
- macOSç­‰ã§ `TMPDIR` ãŒé•·ã„ãƒ‘ã‚¹ã®å ´åˆã€Unix socket ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- `--basetemp=.tmp/pytest` ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’æ¨å¥¨
- pyproject.toml ã® `[tool.coverage.run]` ã§æœªä½¿ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é™¤å¤–æ¸ˆã¿ï¼ˆasync variants, monitoring, cacheç­‰ï¼‰
- å®Ÿéš›ã®ç¨¼åƒã‚³ãƒ¼ãƒ‰ã®ã¿ã§80%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é”æˆ

### ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
```bash
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
black backend/ tests/

# ãƒªãƒ³ãƒˆ
flake8 backend/ tests/

# å‹ãƒã‚§ãƒƒã‚¯
mypy backend/
```

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Forkã™ã‚‹
2. Feature branchã‚’ä½œæˆï¼ˆ`git checkout -b feature/amazing-feature`ï¼‰
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼ˆ`git commit -m 'Add amazing feature'`ï¼‰
4. ãƒ–ãƒ©ãƒ³ãƒã«Pushï¼ˆ`git push origin feature/amazing-feature`ï¼‰
5. Pull Requestã‚’ä½œæˆ

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯[LICENSE](LICENSE)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ™ è¬è¾

- [nfcpy](https://github.com/nfcpy/nfcpy) - NFC/FeliCaé€šä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- [FastAPI](https://fastapi.tiangolo.com/) - é«˜æ€§èƒ½Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [SQLAlchemy](https://www.sqlalchemy.org/) - ORMãƒ©ã‚¤ãƒ–ãƒ©ãƒª

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- **Issues**: [GitHub Issues](https://github.com/tsuyoshi-sk/attendance_system/issues)
- **Discussions**: [GitHub Discussions](https://github.com/tsuyoshi-sk/attendance_system/discussions)
- **Wiki**: [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆWiki](https://github.com/tsuyoshi-sk/attendance_system/wiki)

---

**Â© 2024 Attendance System Project. Built with â¤ï¸ by 4ä¸¦è¡ŒAIé–‹ç™ºãƒãƒ¼ãƒ **
